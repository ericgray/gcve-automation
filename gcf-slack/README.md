# Google Cloud Functions to Slack Example Code

This Python Cloud Function takes one or more key/value pairs from a Google Cloud Pub/Sub message and formats them properly for posting to Slack.

Note that you can create a Pub/Sub topic and subscription during the process of creating a cloud function. Tested with 1st gen Python 3.11 function.

In preparation, set up a Slack app with a webhook and store the URL in Secret Manager. Then configure the cloud function to expose that secret as environment variable `WEBHOOK_URL`.

## Testing and Troubleshooting

Test the webhook directly with `curl`:

```bash
curl -X POST -H 'Content-type: application/json' --data '{"text":"Test post to webhook"}' \
https://hooks.slack.com/services/B324JJDE4/3JKADJ3PKK/jsdJEmapPekaLHAQmoapemzd
```

Test the Pub/Sub subscription with `gcloud`:

```bash
gcloud pubsub topics publish mytopic --message="Test post from gcloud" \
    --attribute=key1=value1,key2=value2
```

Test Pub/Sub from Google Cloud Tools for PowerShell:

```powershell
Publish-GcpsMessage -Topic mytopic -Data "Test post from PowerShell" `
-Attributes @{"Test Key" = "Test Value"}
```

_This example was used during a breakout session demo at VMware Explore 2023: CEIB2548LV Supercharge Google Cloud VMware Engine Infrastructure with Native Services_
